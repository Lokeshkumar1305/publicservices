<div class="cases-module p-2">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h2-bold text-dark mb-1">Case Management (PPMS Core)</h1>
      <p class="body-reg text-muted">Lifecycle management for Service Requests & Event Bookings</p>
    </div>
    <div class="d-flex gap-2">
      <button class="ps-btn ps-btn-outline">
        <mat-icon class="me-2">filter_list</mat-icon>
        FILTER
      </button>
      <button class="ps-btn ps-btn-primary">
        <mat-icon class="me-2">add</mat-icon>
        NEW BOOKING
      </button>
    </div>
  </div>

  <div class="row g-4">
    <div class="col-12">
      <mat-card class="border-0 shadow-sm p-4">
        <div class="table-responsive">
          <table class="table align-middle">
            <thead class="bg-light">
              <tr class="caption-bold text-muted text-uppercase">
                <th>Case ID</th>
                <th>Client / Entity</th>
                <th>Service Type</th>
                <th>Created</th>
                <th>Status</th>
                <th>Amount</th>
                <th class="text-end">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let c of cases">
                <td class="body-bold text-primary-active">{{ c.id }}</td>
                <td class="body-med">{{ c.client }}</td>
                <td>
                  <span class="caption-bold text-muted">{{ c.serviceType }}</span>
                </td>
                <td class="caption-reg">{{ c.createdAt | date: 'shortDate' }}</td>
                <td>
                  <span class="badge rounded-pill px-3 py-2" [ngClass]="getStatusClass(c.status)">
                    {{ c.status }}
                  </span>
                </td>
                <td class="body-bold">${{ c.amount | number: '1.2-2' }}</td>
                <td class="text-end">
                  <button mat-icon-button [matMenuTriggerFor]="menu" class="text-muted">
                    <mat-icon>more_vert</mat-icon>
                  </button>
                  <mat-menu #menu="matMenu">
                    <button
                      mat-menu-item
                      (click)="updateStatus(c, 'In Progress')"
                      *ngIf="c.status === 'Open'"
                    >
                      <mat-icon>play_arrow</mat-icon>
                      <span>Start Work</span>
                    </button>
                    <button
                      mat-menu-item
                      (click)="updateStatus(c, 'Completed')"
                      *ngIf="c.status === 'In Progress'"
                    >
                      <mat-icon>check_circle</mat-icon>
                      <span>Mark Completed</span>
                    </button>
                    <button mat-menu-item *ngIf="c.status === 'Completed'" class="text-success">
                      <mat-icon>receipt</mat-icon>
                      <span>Generate Invoice</span>
                    </button>
                  </mat-menu>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </mat-card>
    </div>
  </div>

  <!-- Engine Insight Footer -->
  <div class="mt-4 p-3 bg-white border rounded-3 d-flex align-items-center">
    <div class="bg-primary-active text-white p-2 rounded-circle me-3">
      <mat-icon>info</mat-icon>
    </div>
    <div class="body-reg text-muted">
      <strong>Enterprise Logic:</strong> Status transitions emit events to the
      <strong>Toucan Event Backbone</strong>. Marking a case "Completed" automatically triggers the
      <strong>Revenue Recognition</strong> logic for financial compliance.
    </div>
  </div>
</div>

<!-- Add MatMenuModule to component imports if needed -->
