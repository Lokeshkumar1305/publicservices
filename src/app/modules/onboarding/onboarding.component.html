<div class="onboarding-screen p-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h2-bold text-dark mb-1">Provisioning Console</h1>
      <p class="body-reg text-muted mb-0">Onboard new clients and deploy custom branded modules.</p>
    </div>
    <div class="d-flex gap-3 align-items-center">
      <div class="filter-tabs bg-light p-1 rounded-3 d-flex gap-1 shadow-sm">
        <button mat-button class="filter-btn rounded-2" [class.active]="activeFilter === 'all'"
          (click)="filterRequests('all')">All</button>
        <button mat-button class="filter-btn rounded-2" [class.active]="activeFilter === 'pending'"
          (click)="filterRequests('pending')">Pending</button>
        <button mat-button class="filter-btn rounded-2" [class.active]="activeFilter === 'completed'"
          (click)="filterRequests('completed')">Active</button>
      </div>

      <button mat-flat-button color="primary" class="rounded-3 px-4" (click)="toggleWizard()">
        <mat-icon class="me-1">rocket_launch</mat-icon> Provision New Firm
      </button>
    </div>
  </div>

  <!-- Onboarding Progress Table -->
  <mat-card class="border-0 shadow-sm rounded-4 overflow-hidden">
    <div class="table-responsive">
      <table class="table mb-0">
        <thead>
          <tr>
            <th class="ps-4">Firm / Brand</th>
            <th>Industry</th>
            <th>Email</th>
            <th>Modules Deployed</th>
            <th class="text-center">Cloud Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let req of filteredRequests" class="align-middle">
            <td class="ps-4">
              <div class="body-bold text-dark">{{ req.firmName }}</div>
              <div class="caption-reg text-indigo"><u>{{ req.firmName.toLowerCase().replace(' ', '-') }}.toucan.ai</u>
              </div>
            </td>
            <td class="body-reg text-muted">{{ req.industry }}</td>
            <td class="body-reg text-muted">{{ req.email }}</td>
            <td>
              <div class="d-flex gap-1 flex-wrap">
                <span *ngFor="let m of req.modules" class="module-chip text-nowrap">{{ m }}</span>
              </div>
            </td>
            <td class="text-center">
              <span class="badge status-badge" [ngClass]="req.status">
                {{ req.status === 'completed' ? 'Live' : 'Provisioning' }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </mat-card>

  <!-- Provisioning Wizard (Modal) -->
  <div class="modal-overlay" *ngIf="showWizard" (click)="toggleWizard()">
    <div class="modal-container p-4 rounded-4 shadow-lg bg-white" (click)="$event.stopPropagation()">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="title1-bold m-0">Tenant Provisioning Engine</h2>
        <button mat-icon-button (click)="toggleWizard()">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <mat-stepper #stepper class="custom-stepper">
        <!-- Step 1: Identity -->
        <mat-step>
          <ng-template matStepLabel>White Label Setup</ng-template>
          <div class="row g-3 mt-2">
            <div class="col-md-6">
              <label class="form-label caption-bold text-dark">Brand/Firm Name *</label>
              <input type="text" class="form-control rounded-3" [(ngModel)]="newFirm.name"
                placeholder="e.g. MediaOne Global">
            </div>
            <div class="col-md-6">
              <label class="form-label caption-bold text-dark">Industry Vertical</label>
              <select class="form-select rounded-3" [(ngModel)]="newFirm.industry">
                <option *ngFor="let ind of industries" [value]="ind">{{ ind }}</option>
              </select>
            </div>
            <div class="col-md-12">
              <label class="form-label caption-bold text-dark">Primary Brand Color</label>
              <div class="d-flex gap-3 align-items-center">
                <input type="color" class="form-control form-control-color p-1 rounded-circle"
                  [(ngModel)]="newFirm.primaryColor">
                <span class="caption-reg text-muted">{{ newFirm.primaryColor }}</span>
              </div>
            </div>
          </div>
          <div class="d-flex justify-content-end mt-4">
            <button mat-flat-button color="primary" matStepperNext>Select Modules</button>
          </div>
        </mat-step>

        <!-- Step 2: Modules Selection (Zoho-inspired) -->
        <mat-step>
          <ng-template matStepLabel>Module Marketplace</ng-template>
          <div class="module-grid mt-3">
            <div *ngFor="let module of availableModules"
              class="module-card p-3 rounded-4 border d-flex flex-column align-items-center text-center clickable transition"
              [class.selected]="module.selected" (click)="module.selected = !module.selected">
              <div class="module-icon-box mb-2">
                <mat-icon>{{ module.icon }}</mat-icon>
              </div>
              <div class="body-bold mb-1">{{ module.name }}</div>
              <div class="caption-reg text-muted">{{ module.description }}</div>
              <div class="module-check position-absolute">
                <mat-icon>{{ module.selected ? 'check_circle' : 'add_circle_outline' }}</mat-icon>
              </div>
            </div>
          </div>
          <div class="d-flex justify-content-between mt-4">
            <button mat-button matStepperPrevious>Back</button>
            <button mat-flat-button color="primary" matStepperNext>Review & Deploy</button>
          </div>
        </mat-step>

        <!-- Step 3: Deployment -->
        <mat-step>
          <ng-template matStepLabel>Deployment</ng-template>
          <div class="deployment-summary p-4 bg-light rounded-4 mt-3">
            <h4 class="body-bold mb-3">Deployment Architecture Preview</h4>
            <ul class="list-unstyled mb-0">
              <li class="mb-2 d-flex gap-2">
                <mat-icon class="text-success" style="font-size: 18px;">cloud_done</mat-icon>
                <span class="body-reg">Dedicated Subdomain: <b>{{ newFirm.name.toLowerCase().replace(' ', '-')
                    }}.toucan.ai</b></span>
              </li>
              <li class="mb-2 d-flex gap-2">
                <mat-icon class="text-success" style="font-size: 18px;">palette</mat-icon>
                <span class="body-reg">White Labeling: <b>Applied with Branding Presets</b></span>
              </li>
              <li class="mb-2 d-flex gap-2">
                <mat-icon class="text-success" style="font-size: 18px;">layers</mat-icon>
                <span class="body-reg">Modules to provision: <b>{{ getSelectedModules().join(', ') }}</b></span>
              </li>
            </ul>
          </div>
          <div class="d-flex justify-content-between mt-4">
            <button mat-button matStepperPrevious>Back</button>
            <button mat-flat-button color="primary" (click)="deployFirm()">Bootstrap Now</button>
          </div>
        </mat-step>
      </mat-stepper>
    </div>
  </div>
</div>